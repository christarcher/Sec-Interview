### 钓鱼上线的主机如何进行利用

**1. 权限维持和环境侦察**

首先，你需要确保这条“上线”的连接不会轻易中断，并尽可能地了解你所处的新环境

- **持久化**：这是首要任务。如果你的初始 Shell 仅仅是一个内存中的进程，一旦机器重启或程序关闭，连接就会丢失。你需要将后门永久地植入系统
  - **常见方法**：利用 **注册表启动项**、**计划任务**或**服务**。虽然这些方法可能被安全软件拦截，但你必须尝试，并结合 **无文件技术**，例如让启动项执行一个从你服务器下载并反射加载的 PowerShell 脚本
- **信息收集**：你需要像侦探一样，了解这台主机的一切
  - **用户信息**：`whoami`、`whoami /all`，查看当前用户的权限。是普通用户还是管理员？
  - **网络信息**：`ipconfig /all`、`route print`，了解主机的 IP 地址、子网掩码、网关和路由表。这能帮助你绘制网络拓扑图
  - **域环境**：`net user /domain`、`net group "domain computers" /domain`，判断主机是否在域内，以及当前用户是否是域用户。如果主机在域内，那么你的攻击范围将大大扩展
  - **系统信息**：`systeminfo`，了解操作系统版本、补丁情况
  - **杀毒软件**：`tasklist` 或 `Get-Process`，检查是否有安全软件正在运行，这决定了你下一步的行动风险

**2. 凭据窃取与权限提升**

获取凭据是横向移动的核心。即使你不是管理员，也可能窃取到管理员的凭据

- **窃取凭据**：这是你最重要的任务
  - **Mimikatz**：如果拥有管理员权限，可以使用 **`Mimikatz`** 提取 `lsass.exe` 进程中的明文密码、哈希和 Kerberos 票据。这是最直接、最有效的方法
  - **内存转储**：如果无法直接运行 Mimikatz，可以尝试将 `lsass.exe` 进程的内存转储到文件，再将文件下载到本地进行离线分析
  - **浏览器密码**：许多用户会在浏览器中保存密码。可以找到浏览器的密码存储路径，并尝试使用工具解密
- **权限提升**：如果当前权限较低，需要想办法获得管理员权限
  - **内核漏洞**：利用操作系统或驱动程序的漏洞进行提权。例如，Windows 历史上就有很多可被利用的提权漏洞
  - **配置缺陷**：寻找软件安装目录的权限配置问题，或者服务的文件路径没有加引号等问题

**3. 横向移动与内网渗透**

一旦你获得了高权限凭据，就可以将攻击范围从单台主机扩展到整个内网

- **哈希传递（Pass-the-Hash）**：利用窃取到的密码哈希，使用 **`psexec.py`** 或 **`Metasploit`** 等工具，在不获取明文密码的情况下，以域用户的身份登录其他机器
- **黄金票据（Golden Ticket）**：如果窃取到了域管理员的哈希，你可以伪造 Kerberos 票据（TGT），从而在整个域内伪装成任何用户
- **端口扫描**：利用这台主机作为跳板，对内网进行端口扫描，发现其他存活的主机和开放的服务
- **漏洞利用**：针对新发现的主机和服务，利用已知的漏洞（如 MS17-010 永恒之蓝）进行横向渗透

**4. 数据窃取与持久化**

渗透的最终目的通常是获取敏感数据

- **文件搜索**：在主机上搜索敏感文件，如配置文件、数据库备份、Office 文档等，寻找密码、密钥或商业机密
- **建立通道**：建立一个隐蔽的数据传输通道，将窃取的数据传送到你的服务器
- **植入后门**：在成功渗透多台机器后，植入多个、不同类型的后门，以确保即使一个后门被发现，你仍有其他通道可以进入